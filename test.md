# üìÑ Ki·∫øn Tr√∫c H·ªá Th·ªëng ‚Äì H·ªá Th·ªëng ƒê·∫∑t h√†ng Theo Ki·∫øn Tr√∫c Microservices

---

## 1. T·ªïng Quan

### M·ª•c ƒë√≠ch c·ªßa h·ªá th·ªëng microservices

H·ªá th·ªëng ƒê·∫∑t h√†ng ƒë∆∞·ª£c x√¢y d·ª±ng theo ki·∫øn tr√∫c Microservices nh·∫±m ph·ª•c v·ª• nhu c·∫ßu mua s·∫Øm tr·ª±c tuy·∫øn v·ªõi kh·∫£ nƒÉng x·ª≠ l√Ω l∆∞·ª£ng l·ªõn ng∆∞·ªùi d√πng, s·∫£n ph·∫©m v√† ƒë∆°n h√†ng. Vi·ªác √°p d·ª•ng ki·∫øn tr√∫c *Microservices* mang l·∫°i nhi·ªÅu l·ª£i √≠ch v∆∞·ª£t tr·ªôi nh∆∞: kh·∫£ nƒÉng m·ªü r·ªông linh ho·∫°t, tri·ªÉn khai ƒë·ªôc l·∫≠p t·ª´ng th√†nh ph·∫ßn, d·ªÖ b·∫£o tr√¨ v√† t√≠ch h·ª£p v·ªõi c√°c h·ªá th·ªëng thanh to√°n, v·∫≠n chuy·ªÉn b√™n ngo√†i.

M·ªói d·ªãch v·ª• s·∫Ω ch·ªãu tr√°ch nhi·ªám cho m·ªôt ch·ª©c nƒÉng duy nh·∫•t, tu√¢n th·ªß nguy√™n t·∫Øc *Single Responsibility* v√† ƒë·∫£m b·∫£o kh·∫£ nƒÉng *m·ªü r·ªông theo chi·ªÅu ngang*.

### C√°c th√†nh ph·∫ßn ch√≠nh v√† ch·ª©c nƒÉng

| Th√†nh ph·∫ßn                   | Ch·ª©c nƒÉng ch√≠nh                                                                                |
| ---------------------------- | ---------------------------------------------------------------------------------------------- |
| *Discovery Server (Eureka)* | ƒêƒÉng k√Ω v√† ph√°t hi·ªán c√°c d·ªãch v·ª•, cho ph√©p c√°c d·ªãch v·ª• t√¨m ki·∫øm v√† giao ti·∫øp v·ªõi nhau. |
| *API Gateway*              | C·ª≠a ng√µ duy nh·∫•t c·ªßa h·ªá th·ªëng, ti·∫øp nh·∫≠n v√† ƒë·ªãnh tuy·∫øn c√°c y√™u c·∫ßu ƒë·∫øn t·ª´ng service th√≠ch h·ª£p. |
| *Product Service*          | Qu·∫£n l√Ω th√¥ng tin s·∫£n ph·∫©m, danh m·ª•c, gi√° c·∫£ v√† h√¨nh ·∫£nh. |
| *Inventory Service*        | Qu·∫£n l√Ω t·ªìn kho, c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng khi c√≥ ƒë∆°n h√†ng m·ªõi. |
| *Order Service*            | X·ª≠ l√Ω ƒë∆°n h√†ng, t·ª´ t·∫°o ƒë∆°n ƒë·∫øn c√°c tr·∫°ng th√°i x·ª≠ l√Ω. |
| *Customer Service*         | Qu·∫£n l√Ω th√¥ng tin kh√°ch h√†ng, t√†i kho·∫£n, ƒë·ªãa ch·ªâ giao h√†ng. |
| *Cart Service*             | Qu·∫£n l√Ω gi·ªè h√†ng c·ªßa ng∆∞·ªùi d√πng. |
| *Notification Service*     | G·ª≠i th√¥ng b√°o ƒë·∫øn kh√°ch h√†ng qua email ho·∫∑c c√°c k√™nh kh√°c. |
| *MySQL Database*           | M·ªói service c√≥ c∆° s·ªü d·ªØ li·ªáu MySQL ri√™ng bi·ªát, ƒë·∫£m b·∫£o t√≠nh ph√¢n t√°ch d·ªØ li·ªáu. |

---

## 2. C√°c Th√†nh Ph·∫ßn H·ªá Th·ªëng

### 2.1. Discovery Server (Eureka)

- ƒêƒÉng k√Ω c√°c d·ªãch v·ª• khi ch√∫ng kh·ªüi ƒë·ªông.
- Cho ph√©p c√°c d·ªãch v·ª• t√¨m ki·∫øm v√† giao ti·∫øp v·ªõi nhau.
- Theo d√µi tr·∫°ng th√°i ho·∫°t ƒë·ªông (health) c·ªßa c√°c d·ªãch v·ª•.
- Cung c·∫•p c∆° ch·∫ø c√¢n b·∫±ng t·∫£i (load balancing) ƒë∆°n gi·∫£n.

### 2.2. API Gateway

- ƒê√≥ng vai tr√≤ l√† ƒëi·ªÉm v√†o duy nh·∫•t cho t·∫•t c·∫£ c√°c y√™u c·∫ßu t·ª´ client.
- ƒê·ªãnh tuy·∫øn c√°c y√™u c·∫ßu HTTP ƒë·∫øn c√°c microservice ph√π h·ª£p.
- X·ª≠ l√Ω x√°c th·ª±c v√† ·ªßy quy·ªÅn ng∆∞·ªùi d√πng.
- Th·ª±c hi·ªán b·∫£o m·∫≠t, gi·ªõi h·∫°n t·ª∑ l·ªá (rate limiting) v√† ghi nh·∫≠t k√Ω.
- T√≠ch h·ª£p v·ªõi Discovery Server ƒë·ªÉ ƒë·ªãnh tuy·∫øn ƒë·ªông.

### 2.3. Product Service

- Qu·∫£n l√Ω danh m·ª•c s·∫£n ph·∫©m v√† th√¥ng tin chi ti·∫øt.
- Cung c·∫•p API ƒë·ªÉ t√¨m ki·∫øm, l·ªçc v√† hi·ªÉn th·ªã s·∫£n ph·∫©m.
- X·ª≠ l√Ω h√¨nh ·∫£nh s·∫£n ph·∫©m v√† thu·ªôc t√≠nh s·∫£n ph·∫©m.
- C·∫≠p nh·∫≠t th√¥ng tin s·∫£n ph·∫©m nh∆∞ gi√°, m√¥ t·∫£, ƒë·∫∑c ƒëi·ªÉm.

### 2.4. Inventory Service

- Theo d√µi s·ªë l∆∞·ª£ng t·ªìn kho c·ªßa t·ª´ng s·∫£n ph·∫©m.
- C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng khi c√≥ ƒë∆°n h√†ng m·ªõi ho·∫∑c ho√†n tr·∫£.
- C·∫£nh b√°o khi h√†ng s·∫Øp h·∫øt.
- Giao ti·∫øp v·ªõi Order Service ƒë·ªÉ ƒë·∫£m b·∫£o ch·ªâ b√°n s·∫£n ph·∫©m c√≥ s·∫µn.

### 2.5. Order Service

- X·ª≠ l√Ω vi·ªác t·∫°o v√† qu·∫£n l√Ω ƒë∆°n h√†ng.
- C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng trong su·ªët quy tr√¨nh.
- T√≠nh to√°n gi√°, thu·∫ø v√† chi ph√≠ v·∫≠n chuy·ªÉn.
- G·ª≠i th√¥ng b√°o ƒë·∫øn Notification Service khi tr·∫°ng th√°i ƒë∆°n h√†ng thay ƒë·ªïi.
- Giao ti·∫øp v·ªõi Inventory Service ƒë·ªÉ c·∫≠p nh·∫≠t t·ªìn kho.

### 2.6. Customer Service

- Qu·∫£n l√Ω th√¥ng tin ng∆∞·ªùi d√πng, h·ªì s∆° v√† x√°c th·ª±c.
- L∆∞u tr·ªØ ƒë·ªãa ch·ªâ giao h√†ng v√† th√¥ng tin thanh to√°n.
- X·ª≠ l√Ω ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p v√† qu·∫£n l√Ω phi√™n.
- Theo d√µi l·ªãch s·ª≠ ƒë∆°n h√†ng c·ªßa kh√°ch h√†ng.

### 2.7. Cart Service

- Qu·∫£n l√Ω gi·ªè h√†ng cho ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p v√† ch∆∞a ƒëƒÉng nh·∫≠p.
- Th√™m, c·∫≠p nh·∫≠t v√† x√≥a s·∫£n ph·∫©m trong gi·ªè h√†ng.
- T√≠nh to√°n t·ªïng gi√° tr·ªã gi·ªè h√†ng.
- Chuy·ªÉn ƒë·ªïi gi·ªè h√†ng th√†nh ƒë∆°n h√†ng.

### 2.8. Notification Service

- G·ª≠i email x√°c nh·∫≠n ƒë∆°n h√†ng, c·∫≠p nh·∫≠t tr·∫°ng th√°i.
- Th√¥ng b√°o v·ªÅ gi·∫£m gi√°, khuy·∫øn m√£i v√† s·∫£n ph·∫©m m·ªõi.
- L∆∞u tr·ªØ m·∫´u th√¥ng b√°o v√† l·ªãch s·ª≠ g·ª≠i.
- X·ª≠ l√Ω h√†ng ƒë·ª£i th√¥ng b√°o ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªô tin c·∫≠y.

### 2.9. C∆° s·ªü d·ªØ li·ªáu MySQL

| D·ªãch v·ª• | C∆° s·ªü d·ªØ li·ªáu | N·ªôi dung l∆∞u tr·ªØ |
| ------- | ------------- | ---------------- |
| Product Service | product-db | Th√¥ng tin s·∫£n ph·∫©m, danh m·ª•c, gi√° c·∫£, h√¨nh ·∫£nh |
| Inventory Service | inventory-db | S·ªë l∆∞·ª£ng t·ªìn kho, thay ƒë·ªïi t·ªìn kho, v·ªã tr√≠ |
| Order Service | order-db | ƒê∆°n h√†ng, chi ti·∫øt ƒë∆°n h√†ng, tr·∫°ng th√°i, l·ªãch s·ª≠ |
| Customer Service | customer-db | Th√¥ng tin kh√°ch h√†ng, t√†i kho·∫£n, ƒë·ªãa ch·ªâ |
| Cart Service | cart-db | Gi·ªè h√†ng, s·∫£n ph·∫©m trong gi·ªè, s·ªë l∆∞·ª£ng |
| Notification Service | notification-db | M·∫´u th√¥ng b√°o, l·ªãch s·ª≠ g·ª≠i, tr·∫°ng th√°i |

---

## 3. Giao Ti·∫øp

### 3.1. Giao ti·∫øp gi·ªØa c√°c d·ªãch v·ª•

- C√°c d·ªãch v·ª• giao ti·∫øp ch·ªß y·∫øu th√¥ng qua *HTTP REST API*.
- T·∫•t c·∫£ request t·ª´ client ƒë·ªÅu ƒëi qua API Gateway ƒë·ªÉ ƒë·∫£m b·∫£o kh·∫£ nƒÉng ki·ªÉm so√°t v√† gi√°m s√°t t·∫≠p trung.
- Giao ti·∫øp kh√¥ng ƒë·ªìng b·ªô gi·ªØa Order Service v√† Notification Service th√¥ng qua *Apache Kafka*.
- Discovery Server (Eureka) gi√∫p c√°c service t√¨m th·∫•y nhau m√† kh√¥ng c·∫ßn bi·∫øt IP tƒ©nh.

### 3.2. API v√† Endpoints

- M·ªói service cung c·∫•p c√°c RESTful API v·ªõi ƒë·ªãnh d·∫°ng JSON.
- API Gateway x√°c th·ª±c v√† ƒë·ªãnh tuy·∫øn requests.
- C√°c endpoints ƒë∆∞·ª£c ghi ch√©p ƒë·∫ßy ƒë·ªß theo chu·∫©n OpenAPI/Swagger.

### 3.3. T√≠nh b·∫£o m·∫≠t v√† tin c·∫≠y

- JWT (JSON Web Token) cho x√°c th·ª±c v√† ·ªßy quy·ªÅn.
- HTTPS cho t·∫•t c·∫£ c√°c k·∫øt n·ªëi.
- Gi·ªõi h·∫°n t·ª∑ l·ªá truy c·∫≠p (Rate limiting) ƒë·ªÉ ngƒÉn ch·∫∑n t·∫•n c√¥ng DDoS.
- Circuit breaker ƒë·ªÉ x·ª≠ l√Ω l·ªói d·ªãch v·ª• v√† tƒÉng kh·∫£ nƒÉng ph·ª•c h·ªìi.

---

## 4. Lu·ªìng D·ªØ Li·ªáu

### 4.1. Lu·ªìng x·ª≠ l√Ω ch√≠nh:

1. Kh√°ch h√†ng truy c·∫≠p h·ªá th·ªëng th√¥ng qua Web/Mobile App.
2. Y√™u c·∫ßu ƒë∆∞·ª£c g·ª≠i ƒë·∫øn API Gateway, x√°c th·ª±c v√† ƒë·ªãnh tuy·∫øn ƒë·∫øn service ph√π h·ª£p.
3. **Duy·ªát v√† T√¨m ki·∫øm s·∫£n ph·∫©m:**
   - API Gateway ‚Üí Product Service ‚Üí Hi·ªÉn th·ªã s·∫£n ph·∫©m cho kh√°ch h√†ng.
4. **Th√™m v√†o gi·ªè h√†ng:**
   - API Gateway ‚Üí Cart Service ‚Üí C·∫≠p nh·∫≠t gi·ªè h√†ng.
   - Cart Service ‚Üí Product Service ‚Üí Ki·ªÉm tra th√¥ng tin s·∫£n ph·∫©m.
   - Cart Service ‚Üí Inventory Service ‚Üí Ki·ªÉm tra t·ªìn kho.
5. **ƒê·∫∑t h√†ng:**
   - API Gateway ‚Üí Order Service ‚Üí T·∫°o ƒë∆°n h√†ng m·ªõi.
   - Order Service ‚Üí Customer Service ‚Üí X√°c nh·∫≠n th√¥ng tin kh√°ch h√†ng.
   - Order Service ‚Üí Inventory Service ‚Üí C·∫≠p nh·∫≠t t·ªìn kho.
   - Order Service ‚Üí Kafka ‚Üí Notification Service ‚Üí G·ª≠i email x√°c nh·∫≠n ƒë∆°n h√†ng.
6. **Theo d√µi ƒë∆°n h√†ng:**
   - API Gateway ‚Üí Order Service ‚Üí Truy v·∫•n tr·∫°ng th√°i ƒë∆°n h√†ng.
   - Order Service ‚Üí Notification Service ‚Üí Th√¥ng b√°o c·∫≠p nh·∫≠t tr·∫°ng th√°i.

### 4.2. X·ª≠ l√Ω d·ªØ li·ªáu kh√¥ng ƒë·ªìng b·ªô

- Kafka x·ª≠ l√Ω giao ti·∫øp kh√¥ng ƒë·ªìng b·ªô gi·ªØa Order Service v√† Notification Service.
- Event-driven architecture cho c√°c thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng.
- Retry mechanism cho c√°c thao t√°c quan tr·ªçng nh∆∞ c·∫≠p nh·∫≠t t·ªìn kho.

---

## 5. S∆° ƒê·ªì

### 5.1. S∆° ƒë·ªì ki·∫øn tr√∫c t·ªïng th·ªÉ

```mermaid
graph TD
    Client[Web/Mobile Client] --> Gateway[API Gateway]
    Gateway --> DS[Discovery Server/Eureka]
    Gateway --> PS[Product Service]
    Gateway --> IS[Inventory Service]
    Gateway --> OS[Order Service]
    Gateway --> CS[Customer Service]
    Gateway --> CaS[Cart Service]
    Gateway --> NS[Notification Service]
    
    PS --> PDB[(Product DB)]
    IS --> IDB[(Inventory DB)]
    OS --> ODB[(Order DB)]
    CS --> CDB[(Customer DB)]
    CaS --> CaDB[(Cart DB)]
    NS --> NDB[(Notification DB)]
    
    OS --> Kafka[Kafka]
    Kafka --> NS
    
    PS -.-> DS
    IS -.-> DS
    OS -.-> DS
    CS -.-> DS
    CaS -.-> DS
    NS -.-> DS
    
    OS --> IS
    CaS --> PS
    CaS --> IS
    OS --> CS
```

### 5.2. Lu·ªìng x·ª≠ l√Ω ƒë∆°n h√†ng

```mermaid
sequenceDiagram
    participant Customer
    participant Gateway as API Gateway
    participant Cart as Cart Service
    participant Order as Order Service
    participant Inventory as Inventory Service
    participant Kafka
    participant Notification as Notification Service
    
    Customer->>Gateway: ƒê·∫∑t h√†ng (Checkout)
    Gateway->>Cart: L·∫•y th√¥ng tin gi·ªè h√†ng
    Cart-->>Gateway: Th√¥ng tin gi·ªè h√†ng
    Gateway->>Order: T·∫°o ƒë∆°n h√†ng
    Order->>Inventory: Ki·ªÉm tra & c·∫≠p nh·∫≠t t·ªìn kho
    Inventory-->>Order: X√°c nh·∫≠n t·ªìn kho
    Order-->>Gateway: X√°c nh·∫≠n ƒë∆°n h√†ng
    Gateway-->>Customer: Th√¥ng b√°o ƒë·∫∑t h√†ng th√†nh c√¥ng
    Order->>Kafka: S·ª± ki·ªán ƒë∆°n h√†ng ƒë√£ t·∫°o
    Kafka->>Notification: Th√¥ng b√°o ƒë∆°n h√†ng m·ªõi
    Notification->>Customer: G·ª≠i email x√°c nh·∫≠n ƒë∆°n h√†ng
```

---

## 6. Kh·∫£ NƒÉng M·ªü R·ªông & Ch·ªãu L·ªói

### 6.1. Kh·∫£ nƒÉng m·ªü r·ªông

- *Scale theo chi·ªÅu ngang* b·∫±ng c√°ch nh√¢n b·∫£n t·ª´ng service.
- C√¢n b·∫±ng t·∫£i (load balancing) qua Eureka v√† Spring Cloud.
- Sharding c∆° s·ªü d·ªØ li·ªáu cho c√°c d·ªãch v·ª• x·ª≠ l√Ω d·ªØ li·ªáu l·ªõn (nh∆∞ Product, Order).
- Caching v·ªõi Redis ƒë·ªÉ gi·∫£m t·∫£i truy v·∫•n DB cho c√°c d·ªØ li·ªáu th∆∞·ªùng xuy√™n ƒë·ªçc.

### 6.2. Ch·ªãu l·ªói v√† x·ª≠ l√Ω l·ªói

- *Circuit Breaker* pattern (Hystrix/Resilience4j) ƒë·ªÉ ngƒÉn cascade failures.
- Retry mechanisms cho c√°c thao t√°c quan tr·ªçng.
- Health checks v√† t·ª± ƒë·ªông kh√¥i ph·ª•c d·ªãch v·ª•.
- Distributed tracing ƒë·ªÉ theo d√µi v√† g·ª° l·ªói requests xuy√™n su·ªët h·ªá th·ªëng.
- Fallback strategies khi d·ªãch v·ª• kh√¥ng kh·∫£ d·ª•ng.

---

## 7. K·∫øt Lu·∫≠n

Ki·∫øn tr√∫c microservices trong h·ªá th·ªëng ƒê·∫∑t h√†ng kh√¥ng ch·ªâ gi√∫p qu·∫£n l√Ω d·ªØ li·ªáu hi·ªáu qu·∫£, m√† c√≤n ƒë·∫£m b·∫£o t√≠nh m·ªü r·ªông, kh·∫£ nƒÉng ph·ª•c v·ª• s·ªë l∆∞·ª£ng l·ªõn ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi v√† ƒë√°p ·ª©ng nhanh v·ªõi thay ƒë·ªïi th·ªã tr∆∞·ªùng. Vi·ªác ph√¢n t√°ch ch·ª©c nƒÉng r√µ r√†ng, k·∫øt h·ª£p v·ªõi c√°c c√¥ng ngh·ªá hi·ªán ƒë·∫°i nh∆∞ Spring Cloud, Eureka, Kafka v√† c√°c ti√™u chu·∫©n giao ti·∫øp RESTful, gi√∫p h·ªá th·ªëng v·∫≠n h√†nh ·ªïn ƒë·ªãnh, d·ªÖ b·∫£o tr√¨ v√† ph√°t tri·ªÉn trong t∆∞∆°ng lai. 